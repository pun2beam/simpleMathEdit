<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MathJax Live Preview</title>

  <!-- MathJax v3 -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
      },
      options: {
        // 右ペイン内だけを対象にして高速化
        renderActions: {
          addMenu: []
        }
      }
    };
  </script>
  <script defer src="./es5/tex-mml-chtml.js"></script>

  <style>
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, sans-serif; }
    .wrap { display: grid; grid-template-columns: 1fr 1fr; height: 100vh; }
    .pane { padding: 12px; box-sizing: border-box; overflow: auto; }
    textarea { width: 100%; height: 100%; resize: none; font: 14px/1.4 ui-monospace, SFMono-Regular, Menlo, monospace; }
    .preview { border-left: 1px solid #ddd; }
    .hint { color: #666; font-size: 12px; margin-bottom: 8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="pane">
      <div class="hint">edit</div>
      <textarea id="src">
インライン: $E=mc^2$

別行表示:
$$
\frac{\mathrm{d}y}{\mathrm{d}x}=g(y)h(x)
$$
      </textarea>
    </div>

    <div class="pane preview">
      <div class="hint">preview</div>
      <div id="out"></div>
    </div>
  </div>

  <script>
    const src = document.getElementById('src');
    const out = document.getElementById('out');

    let timer = null;

    async function render() {
      // HTMLとして解釈させず「テキストとして」入れる（XSS対策）
      out.textContent = src.value;

      // MathJaxの準備完了待ち（初回読み込み中の事故防止）
      if (!window.MathJax || !MathJax.typesetPromise) return;

      // 右ペインだけ再レンダリング
      await MathJax.typesetPromise([out]);
    }

    // 入力のたびに即レンダリングすると重いので軽くデバウンス
    src.addEventListener('input', () => {
      clearTimeout(timer);
      timer = setTimeout(render, 120);
    });

    // 初回描画
    window.addEventListener('load', render);
  </script>
</body>
</html>
